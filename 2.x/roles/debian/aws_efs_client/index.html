<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>ce-provision</title>
  <meta name="viewport" content="width=device-width,minimum-scale=1">
  
  <link rel="stylesheet" href="https://codeenigma.github.io/ce-provision-docs/2.x/css/main.min.a5be948f3ce84fca7dc597e47b7bb98101cec76fa354cce27baa38078b559a24.css">
</head><body class="doc"><header><a href="https://codeenigma.github.io/ce-provision-docs/2.x/home">ce-provision</a></header><article>
        <h1 id="efs-client">EFS client</h1>
<p>Mounts EFS volume(s) to specific mount point(s).</p>
<h2 id="how-the-client-package-is-created">How the client package is created</h2>
<p>Because AWS do not ship a .deb file but 
<a href="https://docs.aws.amazon.com/efs/latest/ug/installing-amazon-efs-utils.html"  target="_blank" rel="noopener">provide build instructions instead</a>
, we use GitHub Actions in a dedicated repository to build the <code>efs-utils</code> package. By default this role will fetch a .deb package from the Code Enigma repository, here:</p>
<ul>
<li>
<a href="https://github.com/codeenigma/aws-efs-utils-deb-builder/tags"  target="_blank" rel="noopener">https://github.com/codeenigma/aws-efs-utils-deb-builder/tags</a>
</li>
</ul>
<p>If you wish to provide your own package, use <code>aws_efs_client.deb_url</code> to provide a full URL to a downloadable .deb file containing AWS EFS utils.</p>
<h2 id="using-the-correct-src-value">Using the correct <code>src</code> value</h2>
<p>The 
<a href="https://docs.ansible.com/ansible/latest/collections/community/aws/efs_info_module.html"  target="_blank" rel="noopener"><code>efs_info</code> role for Ansible</a>
 searches based on the <code>creation_token</code> attribute of a file system. This is usually the same as <code>name</code> <strong>but not always!</strong></p>
<p>If your EFS volume was not created by Ansible or via the console but was created automatically, for example by setting up replication to another region, no matter what you set the human-readable <code>name</code> to the <code>creation_token</code> will remain a dynamically generated value, such as <code>destination-5e6b763c-0f8b-4e90-9392-8c83b2453553</code>. It is the <code>creation_token</code> value that matters, <strong>not</strong> <code>name</code>, so in this case your mount will need to look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>  <span style="color:#f92672">mounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/mnt/shared</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">src</span>: <span style="color:#ae81ff">destination-5e6b763c-0f8b-4e90-9392-8c83b2453553</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">opts</span>: <span style="color:#ae81ff">_netdev</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">state</span>: <span style="color:#ae81ff">present</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">owner</span>: <span style="color:#ae81ff">root</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">group</span>: <span style="color:#ae81ff">root</span>
</span></span></code></pre></div><p>You cannot retrieve the <code>creation_token</code> from the console, you need to use the API, for example:</p>
<pre tabindex="0"><code>aws efs describe-file-systems --profile myaccount --region eu-west-1
</code></pre><p>In the output of listed file systems, for each one you will find an entry like this:</p>
<pre tabindex="0"><code>    &#34;CreationToken&#34;: &#34;destination-fba829fc-3680-4b7d-be6a-147d02c357b3&#34;
</code></pre><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="default-variables">Default variables</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">_mount_opts</span>: <span style="color:#e6db74">&#34;_netdev,noresvport&#34;</span> <span style="color:#75715e"># _netdev tells OS to wait for network before attempting to mount</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">_mount_state</span>: <span style="color:#ae81ff">present</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">aws_efs_client</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">aws_profile</span>: <span style="color:#ae81ff">example</span> <span style="color:#75715e"># AWS boto profile name - can be substituted for &#34;{{ _aws_profile }}&#34; if set</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">region</span>: <span style="color:#ae81ff">eu-west-1</span> <span style="color:#75715e"># AWS region name - can be substituted for &#34;{{ _aws_region }}&#34; if set</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">version</span>: <span style="color:#e6db74">&#34;{{ &#39;1.35.0&#39; if ansible_distribution_major_version | int &lt; 12 else &#39;2.1.0&#39; }}&#34;</span> <span style="color:#75715e"># 2.1.0 requires libssl v3 which is absent on Debian &lt; 12 by default.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build_suffix</span>: <span style="color:#e6db74">&#34;-1_all&#34;</span> <span style="color:#75715e"># sometimes there is a suffix appended to the package name, e.g. `amazon-efs-utils-1.35.0-1_all.deb`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">deb_url</span>: <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e"># provide an alternative location for the .deb package</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># See https://docs.ansible.com/ansible/latest/modules/mount_module.html</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/mnt/shared</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">src</span>: <span style="color:#ae81ff">example-efs</span> <span style="color:#75715e"># this is the EFS &#34;creation_token&#34; which is not always &#34;name&#34; - read the role docs carefully!</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">opts</span>: <span style="color:#e6db74">&#34;{{ _mount_opts }}&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">state</span>: <span style="color:#e6db74">&#34;{{ _mount_state }}&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">owner</span>: <span style="color:#ae81ff">root</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">group</span>: <span style="color:#ae81ff">root</span>
</span></span></code></pre></div><!-- raw HTML omitted -->

    </article>
    <aside>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#efs-client">EFS client</a>
      <ul>
        <li><a href="#how-the-client-package-is-created">How the client package is created</a></li>
        <li><a href="#using-the-correct-src-value">Using the correct <code>src</code> value</a></li>
        <li><a href="#default-variables">Default variables</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </aside><aside class="menu">
<p>Â </p>
<ul>
<li>
<a href="//" >Home</a>

<ul>
<li>
<a href="//install" >Install</a>
</li>
<li>
<a href="//scripts" >Usage</a>
</li>
<li>
<a href="https://codeenigma.github.io/ce-provision-docs/2.x/roles" >Roles</a>

<ul>
<li>
<a href="//roles/aws" >AWS Infrastructure</a>

<ul>
<li>
<a href="//roles/aws/aws_acl" >AWS ACL</a>
</li>
<li>
<a href="//roles/aws/aws_acm" >AWS Certificate Manager</a>
</li>
<li>
<a href="//roles/aws/aws_ami_asg_cleanup" >AWS AMI ASG Cleanup</a>
</li>
<li>
<a href="//roles/aws/aws_ami" >AWS AMI</a>
</li>
<li>
<a href="//roles/aws/aws_backup" >AWS Backup</a>
</li>
<li>
<a href="//roles/aws/aws_backup_validation" >AWS Backup Validation</a>
</li>
<li>
<a href="//roles/aws/aws_cloudfront_distribution" >AWS CloudFront distribution</a>
</li>
<li>
<a href="//roles/aws/aws_cloudwatch_log_group" >Cloudwatch log group</a>
</li>
<li>
<a href="//roles/aws/aws_credentials" >Amazon credentials</a>
</li>
<li>
<a href="//roles/aws/aws_ec2_autoscale_cluster" >Autoscale cluster</a>
</li>
<li>
<a href="//roles/aws/aws_ec2_metric_alarm" >EC2 CloudWatch Metric Alarm</a>
</li>
<li>
<a href="//roles/aws/aws_ec2_with_eip" >EC2 instance with EIP</a>
</li>
<li>
<a href="//roles/aws/aws_efs" >AWS EFS</a>
</li>
<li>
<a href="//roles/aws/aws_elasticache" >AWS ElastiCache</a>
</li>
<li>
<a href="//roles/aws/aws_iam_role" >AWS IAM EC2</a>
</li>
<li>
<a href="//roles/aws/aws_iam_saml" >AWS IAM SAML</a>
</li>
<li>
<a href="//roles/aws/_aws_network_info" >AWS Network Info</a>
</li>
<li>
<a href="//roles/aws/aws_opensearch" >AWS OpenSearch</a>
</li>
<li>
<a href="//roles/aws/aws_provision_ec2_keypair" >AWS key pair.</a>
</li>
<li>
<a href="//roles/aws/aws_rds" >AWS RDS</a>
</li>
<li>
<a href="//roles/aws/aws_resource_group" >AWS Resource Group.</a>
</li>
<li>
<a href="//roles/aws/aws_s3_bucket" >AWS S3 Bucket</a>
</li>
<li>
<a href="//roles/aws/aws_security_groups" >AWS Security Groups</a>
</li>
<li>
<a href="//roles/aws/aws_sg_iptables" >AWS SG/firewall role</a>
</li>
<li>
<a href="//roles/aws/aws_sns" >AWS SNS</a>
</li>
<li>
<a href="//roles/aws/aws_vpc" >VPC</a>
</li>
<li>
<a href="//roles/aws/aws_vpc_route" >Update main route for a given VPC</a>
</li>
<li>
<a href="//roles/aws/aws_vpc_subnet" >VPC</a>
</li>
</ul>
</li>
<li>
<a href="//roles/contrib" >Contributed roles</a>
</li>
<li>
<a href="//roles/debian" >Debian Packages</a>

<ul>
<li>
<a href="//roles/debian/ansible_galaxy" >Ansible Galaxy</a>
</li>
<li>
<a href="//roles/debian/ansible" >Ansible</a>
</li>
<li>
<a href="//roles/debian/apache" >APACHE</a>
</li>
<li>
<a href="//roles/debian/apparmor" >Apparmor</a>
</li>
<li>
<a href="//roles/debian/apt_extra_packages" >Extra packages</a>
</li>
<li>
<a href="//roles/debian/apt_repository" >APT Repository</a>
</li>
<li>
<a href="//roles/debian/apt_unattended_upgrades" >APT Unattended Upgrades</a>
</li>
<li>
<a href="//roles/debian/aws_cli" >AWS CLI</a>
</li>
<li>
<a href="//roles/debian/aws_cloudwatch_agent" >AWS Cloudwatch agent</a>
</li>
<li>
<a href="//roles/debian/aws_efs_client" >EFS client</a>
</li>
<li>
<a href="//roles/debian/aws_ssm_agent" >AWS SSM agent</a>
</li>
<li>
<a href="//roles/debian/ce_deploy" >ce-deploy</a>
</li>
<li>
<a href="//roles/debian/ce_dev" >Extra packages</a>
</li>
<li>
<a href="//roles/debian/ce_patcher" >Automated patching</a>
</li>
<li>
<a href="//roles/debian/ce_provision" >ce-provision</a>
</li>
<li>
<a href="//roles/debian/clamav" >ClamAV</a>
</li>
<li>
<a href="//roles/debian/docker_ce" >Docker CE</a>
</li>
<li>
<a href="//roles/debian/docker_registry" >Docker Registry</a>
</li>
<li>
<a href="//roles/debian/duplicity" >Duplicity</a>
</li>
<li>
<a href="//roles/debian/firewall_config" >Firewall Config</a>
</li>
<li>
<a href="//roles/debian/frontail" >Frontail</a>
</li>
<li>
<a href="//roles/debian/gitlab" >Gitlab</a>
</li>
<li>
<a href="//roles/debian/gitlab_runner" >Gitlab Runner</a>
</li>
<li>
<a href="//roles/debian/gpg_key" >GPG Key</a>
</li>
<li>
<a href="//roles/debian/haproxy" >HA Proxy</a>
</li>
<li>
<a href="//roles/debian/hosts" >Managed /etc/hosts</a>
</li>
<li>
<a href="//roles/debian/jenkins" >Jenkins</a>
</li>
<li>
<a href="//roles/debian/jitsi" >Jitsi</a>
</li>
<li>
<a href="//roles/debian/ldap_server" >LDAP Server</a>
</li>
<li>
<a href="//roles/debian/lhci" >LHCI</a>
</li>
<li>
<a href="//roles/debian/mailpit" >Mailpit</a>
</li>
<li>
<a href="//roles/debian/mount_sync" >Mount sync</a>
</li>
<li>
<a href="//roles/debian/mysql_client" >MariaDB Client</a>
</li>
<li>
<a href="//roles/debian/mysql_server_oracle_ce" >MySQL Server - Oracle Community Edition</a>
</li>
<li>
<a href="//roles/debian/nginx" >NGINX</a>
</li>
<li>
<a href="//roles/debian/nodejs" >NodeJS</a>
</li>
<li>
<a href="//roles/debian/openvpn" >OpenVPN</a>
</li>
<li>
<a href="//roles/debian/packer" >Packer</a>
</li>
<li>
<a href="//roles/debian/pam_linotp" >PAM LinOTP</a>
</li>
<li>
<a href="//roles/debian/php-cli" >PHP terminal client</a>
</li>
<li>
<a href="//roles/debian/php-common" >PHP common components</a>
</li>
<li>
<a href="//roles/debian/php_composer" >PHP Composer</a>
</li>
<li>
<a href="//roles/debian/php-fpm" >PHP-FPM</a>
</li>
<li>
<a href="//roles/debian/phpmyadmin" >phpMyAdmin</a>
</li>
<li>
<a href="//roles/debian/php_xdebug" >PHP XDebug</a>
</li>
<li>
<a href="//roles/debian/postfix" >Postfix</a>
</li>
<li>
<a href="//roles/debian/process_manager" >Process Manager</a>
</li>
<li>
<a href="//roles/debian/python_boto" >Python Boto</a>
</li>
<li>
<a href="//roles/debian/python_common" >Python Common</a>
</li>
<li>
<a href="//roles/debian/python_pip_packages" >Python Pip Packages</a>
</li>
<li>
<a href="//roles/debian/rkhunter" >rkhunter</a>
</li>
<li>
<a href="//roles/debian/rsyslog" >Rsyslog</a>
</li>
<li>
<a href="//roles/debian/solr" >solr</a>
</li>
<li>
<a href="//roles/debian/ssh_server" >SSHD</a>
</li>
<li>
<a href="//roles/debian/ssl" >SSL</a>
</li>
<li>
<a href="//roles/debian/sudo_config" >sudo config</a>
</li>
<li>
<a href="//roles/debian/swap" >Swap</a>
</li>
<li>
<a href="//roles/debian/system" >System</a>
</li>
<li>
<a href="//roles/debian/user_ansible" >User Ansible</a>
</li>
<li>
<a href="//roles/debian/varnish_config" >varnish_config</a>
</li>
<li>
<a href="//roles/debian/wazuh" >wazuh</a>
</li>
</ul>
</li>
<li>
<a href="//roles/_init" >Init role</a>
</li>
<li>
<a href="//roles/_meta" >&ldquo;Meta&rdquo; roles that group individual roles together.</a>

<ul>
<li>
<a href="//roles/_meta/aws_account" >AWS account</a>
</li>
<li>
<a href="//roles/_meta/aws_client_instance" >AWS client</a>
</li>
<li>
<a href="//roles/_meta/aws_region" >AWS region</a>
</li>
</ul>
</li>
<li>
<a href="//roles/_overrides" >_overrides.</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</aside>
    </body>
</html>
